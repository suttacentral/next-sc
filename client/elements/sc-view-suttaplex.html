<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner-lite.html">

<link rel="import" href="suttaplex/sc-title.html">
<link rel="import" href="suttaplex/sc-suttaplex.html">

<dom-module id="sc-view-suttaplex" attributes="divisionTitle">
  <template>
    <style is="custom-style">
      .divisioncontent {
        color: var(--primary-text-color);
        padding: 24px 0;
      }

      .main {
        margin: 0 auto;
        max-width: 720px;
      }

      .suttalist {
        margin: 0 auto;
        max-width: 720px;
        transition: margin-top 0.3s, margin-bottom 0.3s;
      }

      .title {
        margin-left: 64px;
      }

      .expandeditem {
        @apply --shadow-elevation-8dp;
        margin-top: 20px;
        margin-bottom: 20px;
      }

      .node {
        padding: 16px 16px 0;
        color: var(--secondary-text-color);
      }

      .vagganode {
        padding: 0 16px 16px;
        color: var(--secondary-text-color);
      }

      .vagganode.firstvagga, .node + .vagganode {
        padding-top: 0;
      }

      paper-spinner-lite {
        --paper-spinner-color: var(--sc-gold-500);
        left: 50%;
        top: 50px;
      }

      .notfound {
        @apply --paper-font-display1;
      }
    </style>

    <iron-ajax
            auto
            url="[[_getApiUrl(category)]]"
            handle-as="json"
            loading="{{ loadingResults }}"
            last-response="{{ responseData }}"
            last-error='{{ notFound }}'></iron-ajax>

    <div class="divisioncontent main">

      <div class="loadingIndicator">
        <paper-spinner-lite active="{{loadingResultsv}}"></paper-spinner-lite>
      </div>

      <template is="dom-repeat" items="{{responseData}}">

        <template is="dom-if" if="{{_isSuttaplex(item)}}">
          <sc-suttaplex item="[[item]]">
          </sc-suttaplex>
        </template>

        <template is="dom-if" if="{{!_isSuttaplex(item)}}">
          <section class$="[[_calcualteClass(item.type)]]">
            <sc-title input-title="[[item.original_title]]" input-text="[[item.blurb]]"
               input-type="[[item.type]]">
            </sc-title>
          </section>
        </template>

      </template>

  </template>
  </div>
  </template>

  <script>
      class ScViewSuttaplex extends Polymer.Element {
          static get is() {
              return 'sc-view-suttaplex'
          }

          static get properties() {
              return {
                  loadingResults: {
                      type: Boolean,
                      value: true
                  },
                  responseData: {
                      type: Array,
                  },
                  NotFound: {
                      type: Object
                  },
                  titleFontSize: {
                      type: Number,
                      value: 44
                  },
              }
          }

          // Compute API endpoint url
          _getApiUrl(category) {
              return `api/suttaplex/${category}`
          }

          _isSuttaplex(item) {
              return item.type === 'text'
          }

          _calcualteClass(itemType) {
            return itemType === 'grouping' ? 'node' : 'vagganode'
          }
      }

      customElements.define(ScViewSuttaplex.is, ScViewSuttaplex)
  </script>
</dom-module>

