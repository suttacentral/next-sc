<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/iron-lazy-pages/iron-lazy-pages.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../elements/static/home-page.html">
<link rel="import" href="../elements/static/donations-page.html">
<link rel="import" href="../elements/static/downloads-page.html">
<link rel="import" href="../elements/sc-donate-now-page.html">
<link rel="import" href="../elements/static/offline-page.html">
<link rel="import" href="../elements/static/numbering-page.html">
<link rel="import" href="../elements/static/abbreviations-page.html">
<link rel="import" href="../elements/static/methodology-page.html">
<link rel="import" href="../elements/static/acknowledgments-page.html">
<link rel="import" href="../elements/static/licensing-page.html">
<link rel="import" href="../elements/static/about-page.html">
<link rel="import" href="../elements/static/preamble.html">
<link rel="import" href="../elements/static/start.html">
<link rel="import" href="../elements/static/discourses.html">
<link rel="import" href="../elements/static/vinaya.html">
<link rel="import" href="../elements/static/abhidhamma.html">
<link rel="import" href="../elements/static/home-page.html">
<link rel="import" href="../elements/static/subjects.html">
<link rel="import" href="../elements/static/similes.html">
<link rel="import" href="../elements/static/names.html">
<link rel="import" href="../elements/static/terminology.html">
<link rel="import" href="../elements/static/a-new-beginning.html">

<dom-module id="sc-page-static">
  <template>
    <style>
      app-toolbar {
        background-color: var(--sc-primary-color);
        height: auto;
      }

      #lasttoolbar {
        @apply --shadow-elevation-8dp;
        z-index: -1;
        padding-bottom: var(--sc-size-lg);
      }

      h1 {
        @apply --sc-serif-font;
        @apply --sc-mixed-small-caps;
        @apply --sc-skolar-font-size-static-main-title;
        text-align: left;
        color: var(--sc-tertiary-text-color);
        padding-top: 8px;
        padding-bottom: 4px;
        margin: 0;
        line-height: 1em;
        font-weight: normal;
      }

      .subtitle {
        @apply --sc-skolar-font-size-static-subtitle;
        @apply --paper-font-common-base;
        color: var(--sc-tertiary-text-color);
        font-style: italic;
        margin-bottom: 24px;
        margin-top: 0;
        text-align: center;
      }

      .title {
        max-width: 100%;
      }

      .title-text {
        text-align: center;
        color: var(--sc-tertiary-text-color);
      }

      .title-logo-icon {
        vertical-align: bottom;
        height: var(--sc-size-xxl);
        width: var(--sc-size-xxl);
      }

      .page-not-found-container {
        @apply --sc-skolar-font-size-static-subtitle;
        margin: 38px;
      }

      #nav_tabs,
      #second_nav_tabs {
        width: 100%;
        --paper-tabs-selection-bar-color: var(--sc-primary-color-light);
      }

      .nav-link {
        color: var(--sc-tertiary-text-color);
        --paper-tab-ink: var(--sc-primary-color-light);
        padding-left: 10px;
        padding-right: 10px;
        @apply --sc-all-caps;
      }

      #nav_toolbar {
        background-color: var(--sc-primary-color-dark);
        height: auto;
      }

      .link-anchor {
        position: absolute;
        width: calc(100% + 20px);
        height: 100%;
      }

      @media (max-width: 925px) {
        .subtitle {
          @apply --sc-skolar-font-size-xl;
          margin-bottom: 0.5em;
        }
      }

      @media (max-width: 800px) {
        .title {
          margin-left: initial;
        }
      }

      @media (max-width: 600px) {
        h1 {
          @apply --sc-skolar-font-size-xxl;
          padding-top: 0.2em;
        }

        .title-logo-icon {
        height: 40px;
        width: 40px;
      }

        .subtitle {
          @apply --sc-skolar-font-size-md;
          margin-bottom: 0.5em;
        }
      }
    </style>

    <app-toolbar>
      <div class="title" main-title>
        <h1 class="title-text">
          <iron-icon class="title-logo-icon" icon="sc-svg-icons:sc-logo"></iron-icon>
          SuttaCentral
        </h1>
      </div>
    </app-toolbar>
    <app-toolbar id="lasttoolbar">
      <div class="title" main-title>
        <p class="subtitle">{{localize('pageSubtitle')}}</p>
      </div>
    </app-toolbar>
    <app-toolbar id="nav_toolbar" bottom-item>
      <template is="dom-if" if="[[!shouldShowSecondToolbar]]">
        <paper-tabs id="nav_tabs" selected="0" scrollable hide-scroll-buttons>
          <paper-tab class="nav-link" data-name="HOME">
            <div>{{localize('HOME')}}</div>
            <a class="link-anchor" href="/home"></a>
          </paper-tab>
          <paper-tab class="nav-link" data-name="INTRODUCTION">
            <div>{{localize('INTRODUCTION')}}</div>
            <a class="link-anchor" href="/introduction" tabindex="-1"></a>
          </paper-tab>
          <paper-tab class="nav-link" data-name="DONATIONS">
            <div>{{localize('DONATIONS')}}</div>
            <a class="link-anchor" href="/donations" tabindex="-1"></a>
          </paper-tab>
          <paper-tab class="nav-link" data-name="OFFLINE">
            <div>{{localize('USEOFFLINE')}}</div>
            <a class="link-anchor" href="/offline" tabindex="-1"></a>
          </paper-tab>
          <paper-tab class="nav-link" data-name="EXTERNAL_WHAT'S_NEW">
            <div>{{localize('WHATSNEW')}}</div>
            <a class="link-anchor" href="https://discourse.suttacentral.net/c/meta/updates" tabindex="-1" target="_blank">
            </a>
          </paper-tab>
        </paper-tabs>
      </template>
      <template is="dom-if" if="[[shouldShowSecondToolbar]]">
        <paper-tabs id="second_nav_tabs" selected="0" scrollable hide-scroll-buttons>
          <paper-tab class="nav-link" data-name="HOME">
            <div>{{localize('HOME')}}</div>
            <a class="link-anchor" href="/home"></a>
          </paper-tab>
          <paper-tab class="nav-link" data-name="SUBJECTS">
            <div>{{localize('SUBJECTS')}}</div>
            <a class="link-anchor" href="/subjects" tabindex="-1"></a>
          </paper-tab>
          <paper-tab class="nav-link" data-name="SIMILES">
            <div>{{localize('SIMILES')}}</div>
            <a class="link-anchor" href="/similes" tabindex="-1"></a>
          </paper-tab>
            <paper-tab class="nav-link" data-name="NAMES">
            <div>{{localize('NAMES')}}</div>
            <a class="link-anchor" href="/names" tabindex="-1"></a>
          </paper-tab>
          <paper-tab class="nav-link" data-name="TERMINOLOGY">
            <div>{{localize('TERMINOLOGY')}}</div>
            <a class="link-anchor" href="/terminology" tabindex="-1"></a>
          </paper-tab>
        </paper-tabs>
      </template>
    </app-toolbar>

    <iron-lazy-pages id="pages" role="main" selected="[[pages]]" attr-for-selected="name">
      <div name="HOME">
        <home-page></home-page>
      </div>
      <div name="DONATIONS">
        <sc-donations-page></sc-donations-page>
      </div>
      <div name="DONATE-NOW">
        <sc-donate-now-page id="donate"></sc-donate-now-page>
      </div>
      <div name="DOWNLOADS">
        <sc-downloads-page></sc-downloads-page>
      </div>
      <div name="OFFLINE">
        <sc-offline-page></sc-offline-page>
      </div>
      <div name="NUMBERING">
        <sc-numbering-page></sc-numbering-page>
      </div>
      <div name="METHODOLOGY">
        <sc-methodology-page></sc-methodology-page>
      </div>
      <div name="ACKNOWLEDGMENTS">
        <sc-acknowledgments-page></sc-acknowledgments-page>
      </div>
      <div name="LICENSING">
        <sc-licensing-page></sc-licensing-page>
      </div>
      <div name="ABOUT">
        <sc-about-page></sc-about-page>
      </div>
      <div name="INTRODUCTION">
        <sc-preamble></sc-preamble>
      </div>
      <div name="START">
        <sc-start></sc-start>
      </div>
      <div name="DISCOURSES">
        <sc-discourses></sc-discourses>
      </div>
      <div name="VINAYA">
        <sc-vinaya></sc-vinaya>
      </div>
      <div name="ABHIDHAMMA">
        <sc-abhidhamma></sc-abhidhamma>
      </div>
      <div name="A-NEW-BEGINNING">
        <sc-a-new-beginning></sc-a-new-beginning>
      </div>
      <div name="SUBJECTS">
        <sc-subjects-page></sc-subjects-page>
      </div>
      <div name="SIMILES">
        <sc-similes-page></sc-similes-page>
      </div>
      <div name="NAMES">
        <sc-names-page></sc-names-page>
      </div>
      <div name="TERMINOLOGY">
        <sc-terminology-page></sc-terminology-page>
      </div>
      <div name="NOT-FOUND">
        <div class="page-not-found-container">
          <h2>{{localize('error404')}}</h2>
          <h3>{{localize('pageNotFound')}}</h3>
        </div>
      </div>
    </iron-lazy-pages>
  </template>

  <script>
   /**
    * @extends {Polymer.Element}
    * @appliesMixin Polymer.AppLocalizeBehavior
    */
    class SCPageStatic extends Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior], ReduxMixin(Polymer.Element)) {
      static get is() {
          return 'sc-page-static';
      }

      static get properties() {
          return {
              selectedPage: {
                  type: String,
                  observer: '_changeView',
                  statePath: 'currentRoute.name'
              },
              pages: {
                  type: String,
                  value: 'HOME'
              },
              language: {
                  type: String,
                  statePath: 'siteLanguage',
                  observer: '_siteLanguageChanged'
              },
              shouldShowSecondToolbar: {
                  type: Boolean,
                  value: false
              }
          }
      }

      _siteLanguageChanged() {
          this.loadResources(this.resolveUrl(`/localization/elements/sc-page-static/${this.language}.json`));
          this.shadowRoot.querySelector(this._getNavTabsSelector()).notifyResize();
      }

      _selectNavbarLink() {
            const selector = this._getNavTabsSelector();
            const tabs_element = this.shadowRoot.querySelector(selector);
            const tabs = tabs_element.querySelectorAll('paper-tab');
            for (let i = 0; i < tabs.length; i++) {
                if (tabs[i].dataset.name === this.selectedPage) {
                    tabs_element.selectIndex(i);
                    return;
                }
            }
            tabs_element.selectIndex(-1);
      }

      _getNavTabsSelector() {
        let selector = '#nav_tabs';
        if( this.shouldShowSecondToolbar ) {
            selector = '#second_nav_tabs'
        }
        return selector;
      }

      _changeView() {
          this.shouldShowSecondToolbar = ['SUBJECTS', 'SIMILES', 'NAMES', 'TERMINOLOGY'].includes(this.selectedPage);
          this.$.donate.resetForm();
          this.$.pages.selected = this.selectedPage;
          requestAnimationFrame(() => {this._selectNavbarLink()});
      }
    }

    customElements.define(SCPageStatic.is, SCPageStatic);
  </script>
</dom-module>
