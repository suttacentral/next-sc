<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-meta/iron-meta.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../styles/sc-dict-styles.html">

<dom-module id="sc-page-dictionary">
  <template>
    <style is="custom-style" include="sc-dict-styles">
      .dictionary-results-container, .related-terms {
        @apply --sc-sans-font;
        padding: var(--sc-size-xxl) 0;
      }

      .dictionary-results-main {
        max-width: 720px;
        margin: 0 auto;
      }

      .dictionary-results-head {
        display: flex;
        justify-content: space-between;
        padding: 0;
      }

      h1 {
        @apply --paper-font-display1;
        color: var(--sc-secondary-text-color);
        display: inline-block;
        margin: 0 0 0 -2px;
      }

      .dictionary-results-term {
        @apply --sc-serif-font;
        font-weight: bold;
        color: var(--sc-primary-accent-color);
      }

      .termsbutton {
        color: var(--sc-disabled-text-color);
      }

      .related-terms {
        margin: 0 var(--sc-size-md) var(--sc-size-xl) 0;
        text-align: left;
      }

      .related-terms ul {
        margin: var(--sc-size-sm) 0 0 0;
        display: block;
        list-style: none;
        padding: 0;
      }

      .related-terms h3 {
        @apply --paper-font-body1;
        color: var(--sc-secondary-text-color);
        margin: var(--sc-size-md-larger) 0 0 var(--sc-size-md);
        font-weight: bold;
      }

      .dictionary-entries {
        padding: 0;
      }

      .related-terms li {
        @apply --paper-font-body1;
      }

      .related-terms a {
        color: var(--sc-primary-accent-color);
        padding: var(--sc-size-xs) 0 var(--sc-size-xs) var(--sc-size-md);
        margin: var(--sc-size-xs) 0;
        text-decoration: none;
        display: inline-block;
      }

      .related-terms em {
        color: var(--sc-primary-text-color);
      }

      .dictionary-source {
        @apply --paper-font-body1;
        color: var(--sc-secondary-text-color);
        margin: var(--sc-size-sm) 0 var(--sc-size-md);
        font-weight: bold;
        @apply --sc-serif-font;
      }

      .dictionary-book-entry {
        border-bottom: var(--sc-border);
      }

    </style>

    <iron-ajax
        id="ajax"
        url="[[_computeUrl()]]"
        params='[[dictionaryParams]]'
        handle-as="json"
        loading="{{loadingDict}}"
        last-response="{{dictData}}"
        on-response="_didRespond"></iron-ajax>

    <iron-meta id="meta"></iron-meta>

    <div class="dictionary-results-container">
      <main class="dictionary-results-main">
        <div class="dictionary-results-head">
          <h1><span class="dictionary-results-description">Definitions for</span> <span
              class="dictionary-results-term">[[dictionaryParams]]</span></h1>
          <span class="termsbutton" title="Related terms"><paper-icon-button icon="menu">
        </div>
        <div class="dictionary-entries">
<!--           <template is="dom-repeat" items="[[dictionaryResults]]" as="result">
            <div class="dictionary-book-entry">
              <div class="dictionary-source">[[_getDictionaryTitle(result.dict)]]</div>
              <div class="dictionary-text" inner-h-t-m-l="[[result.text]]"></div>
            </div>
          </template> -->
        </div>

        <!--The below is complete mockup. The real related and similar terms to be displayed will have to be calculated-->
<!--         <app-drawer id="drawer" align="right" swipe-open>
          <div class="related-terms">
            <h3>Adjacent Terms</h3>
            <ul class="near-terms">
              <template is="dom-repeat" items="[[relatedItems.adjacent]]">
                <li><a href="/define/[[item.word]]">[[item.word]]</a>
                  <template is="dom-if" if="[[item.trans]]"><em>([[item.trans]])</em></template>
                </li>
              </template>
            </ul>
            <h3>Similar Spelling</h3>
            <ul class="fuzzy-terms">
              <template is="dom-repeat" items="[[relatedItems.similar]]">
                <li><a href="/define/[[item.word]]">[[item.word]]</a>
                  <template is="dom-if" if="[[item.trans]]"><em>([[item.trans]])</em></template>
                </li>
              </template>
            </ul>
          </div>
        </app-drawer> -->

      </main>
    </div>

  </template>

  <script>
      class SCPageDictionary extends ReduxMixin(Polymer.Element) {
          static get is() {
              return 'sc-page-dictionary';
          }

          static get properties() {
              return {
                  dictData: {
                      type: Object
                  },
                  loadingDict: {
                      type: Boolean,
                      value: true
                  },
                  dictionaryParams: {
                      type: Object,
                      statePath: 'dictionaryParams'
                  },
                  dictionaryResults: {
                      type: Object
                  },
                  dictionaryTitles: {
                      type: Object,
                      value: {
                          'ncped': 'New Concise Pali English Dictionary',
                          'cped': 'Concise Pali English Dictionary',
                          'dhammika': 'Nature and the Environment in Early Buddhism by S. Dhammika',
                          'dppn': 'Pali Proper Names',
                          'pts': 'PTS Pali English Dictionary'
                      }
                  }
              }
          }

          _computeUrl() {
              console.log("compute URL");
              return `${this.$.meta.byKey('API_ROOT')}/dictionary_full`;
          }

          _didRespond() {
              console.log("Ajax has responded");
              console.log(this.dictData);
          }

          _getDictionaryTitle(dict) {
              return this.dictionaryTitles[dict];
          }

          // toggles the drawer on the right to show the related/similar items.
          // _toggleDrawer() {
          //     this.$.drawer.toggle();
          // }
        
      }

      customElements.define(SCPageDictionary.is, SCPageDictionary);
  </script>
</dom-module>
