<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../../styles/sc-suttaplex-styles.html">
<link rel="import" href="sc-parallels.html">

<!--
This is the outline of the parallels-table which is used in sc-suttaplex.html.
This parallels-table is further populated with the additional info for each relevant parallel sutta,
which is loaded from `../data/suttas` in **sc-parallels.html**.
-->
<dom-module id="sc-view-parallels">
  <template>
    <style is="custom-style" include="sc-suttaplex-styles">
      .parallels-expanded {
        padding: 16px;
      }

      .parallels-table {
        border-collapse: separate;
        border-spacing: 8px 8px;
        margin: 0 auto;
        width: 80%;
      }

      .parallels-root-cell,
      .parallels-parallel-cell {
        border: 1px solid rgba(0, 0, 0, 0.12);
        border-radius: 2px;
        padding: 8px 12px 2px;
      }

      .parallels-parallel-cell {
        width: 100%;
      }

      .parallels-root-cell {
        text-align: center;
      }

      .parallels-root-id {
        @apply --paper-font-subhead;
        @apply --sc-serif-font;
      }

      tbody {
        display: block;
        margin-bottom: 8px;
      }
    </style>
    <div class="parallels-expanded">
      <table class="parallels-table">
        <template is="dom-repeat" items="[[showParallel]]" as="suttaurl">
          <tbody>
          <tr class="parallels-row">
            <td class="parallels-root-cell parallels-table-cell" rowspan$="[[_computeRowspan(suttaurl)]]">
              <div class="parallels-root-id root" title="SuttaCentral ID">[[suttaurl.id]]</div>
              <paper-button flat class="dense" title="Go to text in original language"><a
                  href="">[[originalLanguage]]</a></paper-button>
            </td>
            <td class="parallels-relation-cell">
              <iron-icon icon$="[[_computeFirstParallelIcon(suttaurl)]]"
                         title$="[[_computeFirstParallelTitle(suttaurl)]]"></iron-icon>
            </td>
            <td class="parallels-parallel-cell">
              <sc-parallels parallel-url="[[_computeFirstParallelUrl(suttaurl)]]"
                            parallel-id="[[_computeFirstParallelId(suttaurl)]]"
                            input-language="[[inputLanguage]]"></sc-parallels>
            </td>
          </tr>
          <template is="dom-repeat" items="[[_computeOtherParallels(suttaurl)]]" as="item">
            <tr>
              <td class="parallels-relation-cell">
                <iron-icon icon="[[item.icon]]" title="[[_computeTitle(item.icon)]]"></iron-icon>
              </td>
              <td class="parallels-parallel-cell">
                <sc-parallels parallel-url="[[item.url]]" parallel-id="[[item.id]]"
                              input-language="[[inputLanguage]]"></sc-parallels>
              </td>
            </tr>
          </template>
          </tbody>
        </template>
      </table>
    </div>

  </template>

  <script>
      Polymer({
          is: 'sc-view-parallels',

          properties: {
              showParallel: Array,
              originalLanguage: String,
              inputLanguage: String,
              inputUrl: String
          },
          _computeTitle: function(icon) {
              // returns the correct title for each icon that denotes a parallel.
              switch (icon) {
                  case 'swap-horiz':
                      return 'Full Parallel';
                  case 'compare-arrows':
                      return 'Resembling Parallel';
                  case 'editor:format-quote':
                      return 'Mention';
                  case 'cached':
                      return 'Retelling';
              }
          },
          // comment
          // returns the rowspan needed for each parallel.
          _computeRowspan: function(suttaurl) {
              return suttaurl.relations.length;
          },
          // returns the icon for the first parallel.
          _computeFirstParallelIcon: function(suttaurl) {
              return suttaurl.relations[0].icon;
          },
          // returns the title for the first parallel.
          _computeFirstParallelTitle: function(suttaurl) {
              return this._computeTitle(suttaurl.relations[0].icon);
          },
          // returns the url for the first parallel.
          _computeFirstParallelUrl: function(suttaurl) {
              return suttaurl.relations[0].url;
          },
          // returns the ID for the first parallel.
          _computeFirstParallelId: function(suttaurl) {
              return suttaurl.relations[0].id;
          },
          // returns an array with the data for all other parallels than the first.
          _computeOtherParallels: function(suttaurl) {
              const parallelarray = [];
              for (let i = 1; i < suttaurl.relations.length; i++) {
                  parallelarray[i - 1] = suttaurl.relations[i];
              }
              return parallelarray;
          }
      });
  </script>
</dom-module>