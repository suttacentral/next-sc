<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">

<!--
Language-menu used in the suttaplex card for denoting which translations exist of this particular text
-->
<dom-module id="language-menu">
  <template>
    <style>
      :host {
        --primary-color: var(--paper-green-a700);
      }

      paper-dropdown-menu, paper-listbox {
        width: 200px;
        --paper-input-container-input: {
          text-transform: capitalize;
        };
      }

      a {
        text-decoration: none;
        color: inherit;
      }

      paper-item {
        text-transform: capitalize;
      }

      .root-lang {
        color: var(--paper-green-a700);
      }

      .root-lang:hover {
        cursor: pointer;
        color: var(--paper-green-700)
      }

      .hide-element {
        display: none;
      }

      .iso-code {
        color: var(--secondary-text-color);
        @apply --paper-font-caption;
        @apply --sc-sans-font;
        position: absolute;
        right: 15px;
        margin-top: -34px;
        margin-left: 10px;
        text-transform: none;
        pointer-events: none;
      }

      .language-choice-box:hover {
        background-color: var(--paper-grey-200);
        cursor: pointer;
      }

      .separator {
        border: 0;
        height: 0;
        margin: 0;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      }

    </style>

    <paper-dropdown-menu vertical-align="top" class="custom" label="[[titleLabel]]"
                         title="Select a translation in another language" id="paper-dropdown-menu"
                         dynamic-align=true>
      <paper-listbox slot="dropdown-content">
        <paper-item class$="root-lang [[_computeHide(originalLanguage)]]" title="Original language">
          <a href="/[[inputUrl]]/[[originalLanguage]]">[[originalLanguage]]</a>
        </paper-item>
        <template is="dom-repeat" items="[[languageChoice]]" as="language">
          <template is="dom-if" if="[[!_otherLanguage(language, inputLanguage)]]">
            <hr class="separator">
            <section class="language-choice-box">
              <paper-item id='[[language.id]]' title="[[_languageTitle(language)]]">
                <paper-item-body>
                  <a href="/[[language.id]]/?author=[[language.author]]">[[_computeAuthorForList(language.author)]]</a>
                </paper-item-body>
              </paper-item>
            </section>
            <div class="iso-code">[[language.lang]]</div>
          </template>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>

  </template>

  <script>
      class SCLanguageMenu extends Polymer.Element {
          static get is() {
              return 'language-menu';
          }

          static get properties() {
              return {
                  languageChoice: {
                      type: Array,
                      notify: true
                  },
                  titleLabel: String,
                  inputLanguage: String,
                  originalLanguage: String,
                  inputUrl: String,
                  newLanguage: {
                      type: String,
                      computed: "_otherLanguage(languageChoice, inputLanguage)"
                  }
              }
          }

          // does not list items that are from the inputLanguage because those are listed elsewhere.
          _otherLanguage(languageChoice, inputLanguage) {
              return !!(languageChoice && languageChoice.lang === inputLanguage);
          }

          _computeHide(checkText) {
              return checkText ? checkText : "hide-element";
          }

          // If author name is too long it looks really bad in paper-item so just cut it.
          _shortenAuthor(author) {
              if (author.length > 16) {
                  return `${author.substring(0, 15)}...`
              } else {
                  return author
              }
          }

          _computeAuthor(author) {
              return author ? author : "Anonym"
          }

          _computeAuthorForList(author) {
              return this._shortenAuthor(this._computeAuthor(author))
          }

          _languageTitle(language) {
              return `Select '${language.lang}' translation by ${this._computeAuthor(language.author)}`
          }
      }

      customElements.define(SCLanguageMenu.is, SCLanguageMenu)
  </script>
</dom-module>
