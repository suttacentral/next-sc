<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<link rel="import" href="../styles/static-styles.html">

<dom-module id="sc-donate-now-page">
  <template>
    <style include="static-styles">
      .flex-row {
        display: flex;
      }

      .form-prefix {
        margin-right: 0.5em;
      }
    </style>
    <iron-ajax
        auto
        url="/api/currencies"
        handle-as="json"
        last-response="{{ currencies }}"></iron-ajax>

    <div id="page-wrap">
      <main>
        <section>
          <form>

            <paper-input label="Name">
              <iron-icon icon="social:person" slot="prefix" class="form-prefix"></iron-icon>
            </paper-input>

            <paper-input label="Email">
              <iron-icon icon="mail" slot="prefix" class="form-prefix"></iron-icon>
            </paper-input>

            <paper-input label="Message">
              <iron-icon icon="communication:message" slot="prefix" class="form-prefix"></iron-icon>
            </paper-input>

            <div class="flex-row">
                <paper-dropdown-menu slot="prefix" class="form-prefix">
                    <template is="dom-repeat" items="{{currencies}}">
                      <paper-item>[[item.symbol]]</paper-item>
                    </template>
                  </paper-dropdown-menu>
                  <paper-input label="Amount" type="number">
                  </paper-input>
            </div>

            <label>Card
              <div class="card-element"></div>
            </label>

        </form>
        </section>
      </main>
    </div>
  </template>

  <script>
    class SCDonateNow extends Polymer.Element {
      static get is() {
          return 'sc-donate-now-page';
      }

      static get properties() {
        
        currencies: {
          type: Array
          observer: 'currenciesOb'
        }

      }

      constructor() {
        super();
        this.stripe = Stripe('pk_test_vFqwBPDW08c5AKXMGLKaeJaB');
        this.stripe_elements = this.stripe.elements();
      }

      ready() {
        super.ready();
        let stripe_div = this.shadowRoot.querySelector('.card-element');

        let card = this.stripe_elements.create('card');
        card.mount(stripe_div);

        card.addEventListener('change', ({
          error
        }) => {
          if (error) {
            console.log(error);
          }
        })
      }

      currenciesOb(e) {
        console.log(e);
      }
    }
    customElements.define(SCDonateNow.is, SCDonateNow);
  </script>
</dom-module>